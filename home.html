<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeXMatrix.com - Dashboard</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg-color: #121217; --panel-color: #1a1a20; --text-color: #B8B8BD;
  --highlight-color: #00A381; --border-color: #2e2e3a; --card-color: #21212c;
  --btn-bg-hover: #007a61; --btn-green: #00A381; --btn-shadow: rgba(0, 163, 129, 0.4);
}
*{margin:0; padding:0; box-sizing:border-box;}
body{font-family:'Inter',sans-serif; background:var(--bg-color); color:var(--text-color); display:flex; min-height:100vh;}

/* Sidebar */
.sidebar{
  width:260px; background:var(--panel-color); border-right:1px solid var(--border-color);
  transition: width 0.3s; display:flex; flex-direction:column; justify-content:space-between;
}
.sidebar.collapsed{width:70px;}
.sidebar-header{display:flex; align-items:center; justify-content:space-between; padding:20px; font-size:1.2rem; font-weight:600;}
.toggle-btn{cursor:pointer; color:var(--highlight-color);}
.sidebar-menu{flex:1;}
.sidebar-menu a{
  display:flex; align-items:center; padding:15px 20px; text-decoration:none; color:var(--text-color); font-weight:500;
  transition:0.2s; border-left:3px solid transparent;
}
.sidebar-menu a:hover{background:#1f1f28; border-left:3px solid var(--highlight-color);}
.sidebar-menu i{margin-right:15px; width:20px; text-align:center;}
.sidebar.collapsed .sidebar-menu span{display:none;}
.sidebar.collapsed .sidebar-menu i{margin-right:0; text-align:center; width:100%;}

/* Sidebar footer (social links & feedback) */
.sidebar-footer {
  display:flex; flex-direction:column; align-items:center; gap:15px; padding:20px; transition:all 0.3s;
}
.sidebar-footer a{color:var(--highlight-color); font-size:1.5rem; text-decoration:none;}
.sidebar-footer span{font-size:0.85rem; color:var(--text-color);}
.sidebar.collapsed .sidebar-footer span{display:none;}

/* Main content */
.main-content{flex:1; padding:30px; display:flex; flex-direction:column;}
.header{display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;}
.user-info{display:flex; align-items:center; gap:15px;}
.user-info img{width:50px; height:50px; border-radius:50%; object-fit:cover; border:2px solid var(--highlight-color);}
.user-info div{display:flex; flex-direction:column;}
.btn-green{padding:10px 20px; background:var(--btn-green); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; box-shadow:0 4px 12px var(--btn-shadow);}
.btn-green:hover{background:var(--btn-bg-hover);}

/* Dashboard widgets */
.dashboard-widgets{display:grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap:25px; margin-bottom:40px;}
.card{background:var(--card-color); padding:20px; border-radius:12px; border:1px solid var(--border-color); transition:0.3s;}
.card:hover{transform:translateY(-5px); box-shadow:0 5px 20px rgba(0,163,129,0.3);}
.card h3{margin-bottom:15px; color:white;}
.events-list{list-style:none; padding-left:0;}
.events-list li{padding:8px 0; border-bottom:1px solid var(--border-color);}

/* Performance circle */
.performance-container{display:flex; flex-direction:column; align-items:center; justify-content:center;}
canvas{max-width:200px; max-height:200px;}
</style>
</head>
<body>

<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span id="sidebar-title">Menu</span>
    <i class="fas fa-bars toggle-btn" id="sidebar-toggle"></i>
  </div>
  <div class="sidebar-menu">
    <a href="#"><i class="fa-solid fa-gauge-high"></i> <span>Dashboard</span></a>
    <a href="#"><i class="fa-solid fa-chart-line"></i> <span>Live Charts</span></a>
    <a href="#"><i class="fa-solid fa-layer-group"></i> <span>Indicators</span></a>
    <a href="#"><i class="fa-solid fa-arrow-trend-up"></i> <span>Stock Updates</span></a>
    <a href="#"><i class="fa-solid fa-globe"></i> <span>News & Events</span></a>
    <a href="#"><i class="fa-solid fa-graduation-cap"></i> <span>Education</span></a>
    <a href="#"><i class="fa-solid fa-tags"></i> <span>Pricing</span></a>
    <a href="#"><i class="fa-solid fa-user-gear"></i> <span>Settings</span></a>
    <a href="#"><i class="fa-solid fa-comment-dots"></i> <span>Feedback</span></a>
  </div>
  <div class="sidebar-footer">
    <a href="https://x.com/Trade_X_Matrix?t=ErdQ5uh34oKHrueT47HNqQ&s=08"><i class="fab fa-twitter"></i> <span>Twitter</span></a>
    <a href="https://www.instagram.com/trade_x_matrix?igsh=MXNlNDBuZGcxczNwMw=="><i class="fab fa-instagram"></i> <span>Instagram</span></a>
    <a href="mailto:support@tradexmatrix.com"><i class="fa-solid fa-envelope"></i> <span>Support</span></a>
  </div>
</div>

<div class="main-content">
  <div class="header">
    <h1>Trade X Matrix Dashboard</h1>
    <div class="user-info">
      <img id="user-avatar" src="https://i.imgur.com/your-default-avatar.png" alt="avatar">
      <div>
        <span id="username">Loading...</span>
      </div>
      <button class="btn-green" id="signout-btn">Sign Out</button>
    </div>
  </div>

  <div class="dashboard-widgets">
    <div class="card performance-card">
      <h3>Performance</h3>
      <div class="performance-container">
        <canvas id="performanceChart"></canvas>
        <span id="performanceText">0%</span>
      </div>
    </div>

    <div class="card events-card">
      <h3>Daily Events</h3>
      <ul class="events-list" id="eventsList">
        <li>No events yet.</li>
      </ul>
    </div>

    <div class="card charts-card">
      <h3>Live Charts & Indicators</h3>
      <p>Charts and indicators will appear here dynamically.</p>
    </div>
  </div>
</div>

<script type="module">
import { auth, db } from './src/firebase/firebase.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Sidebar toggle (expand/collapse)
const sidebar = document.getElementById('sidebar');
const toggleBtn = document.getElementById('sidebar-toggle');
toggleBtn.addEventListener('click', () => {
  sidebar.classList.toggle('collapsed');
});

// Signout
document.getElementById('signout-btn').addEventListener('click', async ()=>{
  await signOut(auth);
  window.location.href="login.html";
});

// Fetch username from Firebase
onAuthStateChanged(auth, async (user)=>{
  if(user){
    const uid = user.uid;
    const userRef = doc(db,"users",uid);
    const userSnap = await getDoc(userRef);
    if(userSnap.exists()){
      const data = userSnap.data();
      document.getElementById('username').innerText = data.username || "Trader";
    }
  } else {
    window.location.href="login.html";
  }
});

// Performance chart placeholder
function drawPerformanceChart(percent=0){
  const ctx = document.getElementById('performanceChart').getContext('2d');
  new Chart(ctx,{
    type:'doughnut',
    data:{datasets:[{data:[percent,100-percent],backgroundColor:['var(--highlight-color)', '#2e2e3a'],borderWidth:0}]},
    options:{cutout:'75%', responsive:true, plugins:{legend:{display:false}}}
  });
}
drawPerformanceChart();

// Load Chart.js dynamically
const chartScript = document.createElement('script');
chartScript.src = "https://cdn.jsdelivr.net/npm/chart.js";
document.body.appendChild(chartScript);
</script>
</body>
</html>
