<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Trade X Matrix - Professional Trading Platform</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<style>
:root {
  --bg:#121217; --panel:#1a1a20; --card:#21212c; --muted:#8b8b90;
  --text:#B8B8BD; --accent:#00A381; --border:#2e2e3a; --green:#00A381; --green-hover:#007a61;
}
* { box-sizing:border-box; margin:0; padding:0; }
body {
  font-family:'Inter',system-ui,-apple-system,"Segoe UI",Roboto;
  background:var(--bg); color:var(--text);
  display:flex; min-height:100vh; overflow-x:hidden;
}

/* SIDEBAR */
.sidebar {
  width:260px; min-width:70px; background:var(--panel);
  border-right:1px solid var(--border); display:flex; flex-direction:column;
  transition:width .25s ease, transform .25s ease; z-index:999;
}
.sidebar.collapsed { width:70px; }
.sidebar.mobile-hidden { transform:translateX(-100%); }

.sidebar .top { display:flex; align-items:center; padding:16px; border-bottom:1px solid var(--border); }
.brand { display:flex; align-items:center; gap:10px; cursor:pointer; }
.brand img { height:36px; width:auto; }
.brand .title { font-weight:700; font-size:1rem; white-space:nowrap; }
.sidebar.collapsed .brand .title { display:none; }

/* MENU */
.menu { flex:1; overflow-y:auto; padding:10px; display:flex; flex-direction:column; gap:4px; }
.menu a {
  display:flex; align-items:center; gap:12px; padding:10px 14px;
  border-radius:8px; color:var(--text); text-decoration:none; transition:background .2s;
}
.menu a i { width:20px; text-align:center; }
.menu a:hover { background:rgba(255,255,255,0.05); color:white; }
.sidebar.collapsed .menu a .label { display:none; }

/* FOOTER */
.bottom { padding:12px 14px; border-top:1px solid var(--border); display:flex; flex-direction:column; align-items:center; gap:8px; }
.socials { display:flex; gap:10px; }
.socials a { color:var(--accent); font-size:1.1rem; transition:color .2s; }
.socials a:hover { color:white; }

/* MAIN */
.main { flex:1; display:flex; flex-direction:column; transition:margin-left .25s ease; margin-left:260px; padding:24px; }
.sidebar.collapsed ~ .main { margin-left:70px; }

/* HEADER */
.header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
.h-title { font-size:1.2rem; font-weight:700; color:white; }

/* USER PROFILE IN MAIN */
.user-profile { display:flex; align-items:center; gap:16px; padding:16px; background:var(--card); border-radius:12px; border:1px solid var(--border); margin-bottom:20px; }
.user-avatar { width:72px; height:72px; border-radius:50%; overflow:hidden; border:2px solid var(--accent); }
.user-avatar img { width:100%; height:100%; object-fit:cover; }
.user-info { display:flex; flex-direction:column; }
.user-info .username { font-weight:700; font-size:1.2rem; color:white; }
.user-info .plan { font-size:0.9rem; color:var(--muted); margin-top:2px; }

/* SIGNOUT BUTTON TOP RIGHT */
.signout { padding:8px 14px; background:var(--green); border:none; color:white; border-radius:8px; font-weight:700; cursor:pointer; }
.signout:hover { background:var(--green-hover); }

/* GRID CARDS */
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:18px; }
.card { background:var(--card); border-radius:12px; padding:16px; border:1px solid var(--border); transition:transform .15s; }
.card:hover { transform:translateY(-5px); }
.events-list { list-style:none; display:flex; flex-direction:column; gap:8px; }
.events-list li { padding:10px; border-radius:8px; background:rgba(255,255,255,0.03); }

/* OVERLAY FOR MOBILE */
.overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); opacity:0; visibility:hidden; transition:opacity .25s ease; z-index:998; }
.overlay.active { opacity:1; visibility:visible; }

/* RESPONSIVE */
@media(max-width:900px){
  .sidebar { position:fixed; top:0; bottom:0; left:0; transform:translateX(-100%); }
  .sidebar.mobile-visible { transform:translateX(0); }
  .main { margin-left:0; padding:16px; }
}
</style>
</head>

<body>
<div class="overlay" id="overlay"></div>

<aside class="sidebar" id="sidebar">
  <div class="top">
    <div class="brand" id="logoToggle">
      <img src="https://raw.githubusercontent.com/TM1476/TradeXMatrix/main/logo-pica.png" alt="logo" />
      <span class="title">TradeXMatrix</span>
    </div>
  </div>

  <nav class="menu">
    <a href="#"><i class="fa-solid fa-gauge-high"></i><span class="label">Dashboard</span></a>
    <a href="#"><i class="fa-solid fa-chart-line"></i><span class="label">Live Charts</span></a>
    <a href="#"><i class="fa-solid fa-layer-group"></i><span class="label">Indicators</span></a>
    <a href="#"><i class="fa-solid fa-globe"></i><span class="label">News & Events</span></a>
    <a href="#"><i class="fa-solid fa-graduation-cap"></i><span class="label">Education</span></a>
    <a href="#"><i class="fa-solid fa-list"></i><span class="label">Stocks List</span></a>
    <a href="mailto:support@tradexmatrix.com"><i class="fa-solid fa-envelope"></i><span class="label">Support</span></a>
    <a href="#"><i class="fa-solid fa-comment-dots"></i><span class="label">Feedback</span></a>
    <a href="#"><i class="fa-solid fa-user-gear"></i><span class="label">Settings</span></a>
  </nav>

  <div class="bottom">
    <div class="socials">
      <a href="https://x.com/Trade_X_Matrix?t=ErdQ5uh34oKHrueT47HNqQ&s=08"><i class="fab fa-twitter"></i></a>
      <a href="https://www.instagram.com/trade_x_matrix?igsh=MXNlNDBuZGcxczNwMw=="><i class="fab fa-instagram"></i></a>
    </div>
  </div>
</aside>

<main class="main">
  <header class="header">
    <div class="h-title">TradeXMatrix Dashboard</div>
    <button class="signout" id="signoutBtn">Sign Out</button>
  </header>

  <div class="user-profile">
    <div class="user-avatar"><img src="https://raw.githubusercontent.com/TM1476/TradeXMatrix/main/avatar.png" alt="avatar" /></div>
    <div class="user-info">
      <div class="username" id="username">Loading...</div>
      <div class="plan" id="userPlan">Free Tier</div>
    </div>
  </div>

  <section class="grid">
    <article class="card" id="performanceCard">
      <h3>Performance</h3>
      <div id="performanceText" style="font-weight:700;font-size:1.1rem;color:white;">Tracking usage...</div>
    </article>

    <article class="card" id="newsCard">
      <h3>News & Daily Events</h3>
      <ul class="events-list" id="eventsList">
        <li>Loading events...</li>
      </ul>
    </article>

    <article class="card" id="chartsCard">
      <h3>Live Charts & Indicators</h3>
      <p style="color:var(--muted)">Embed TradingView or your custom chart widgets here.</p>
    </article>
  </section>
</main>

<script type="module">
import { auth, db } from './src/firebase/firebase.js';
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');
const logoToggle = document.getElementById('logoToggle');

/* Logo toggle sidebar */
logoToggle.addEventListener('click', () => {
  if(window.innerWidth<=900){
    sidebar.classList.toggle('mobile-visible');
    overlay.classList.toggle('active');
  } else {
    sidebar.classList.toggle('collapsed');
    localStorage.setItem('sidebar-collapsed', sidebar.classList.contains('collapsed')?'1':'0');
  }
});

overlay.addEventListener('click', () => {
  sidebar.classList.remove('mobile-visible');
  overlay.classList.remove('active');
});

/* Restore sidebar state */
if(localStorage.getItem('sidebar-collapsed')==='1') sidebar.classList.add('collapsed');

/* Sign out */
document.getElementById('signoutBtn').addEventListener('click', async()=>{
  await signOut(auth);
  window.location.href='login.html';
});

/* Fetch username and plan */
onAuthStateChanged(auth, async(user)=>{
  if(!user) return window.location.href='login.html';
  try{
    const ref=doc(db,'users',user.uid);
    const snap=await getDoc(ref);
    if(snap.exists()){
      const data=snap.data();
      document.getElementById('username').innerText = data.username || 'Trader';
      document.getElementById('userPlan').innerText = data.accountTier || 'Free Tier';
    } else {
      document.getElementById('username').innerText = user.displayName || 'Trader';
      document.getElementById('userPlan').innerText = 'Free Tier';
    }
  }catch(e){ console.error(e); }
});
</script>
</body>
</html>
