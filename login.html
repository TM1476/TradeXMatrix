<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade X Matrix - Login</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<style>
  :root {
    --bg-color: #121217;
    --panel-color: #1a1a20;
    --text-color: #B8B8BD;
    --highlight-color: #00A381;
    --border-color: #2e2e3a;
    --card-color: #21212c;
    --btn-bg-hover: #007a61;
    --btn-shadow: rgba(0, 163, 129, 0.4);
    --error-color: #ff6347;
  }
  * {margin:0; padding:0; box-sizing:border-box;}
  body {min-height:100vh; overflow-x:hidden; font-family:'Inter',sans-serif; color:var(--text-color); background-color:var(--bg-color); display:flex; justify-content:center; align-items:center; padding:20px;}
  body::before {content:''; position:fixed; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle, rgba(13,13,18,0.95), rgba(18,18,23,0.9)); z-index:-1;}

  .login-page {display:flex; flex-direction:column; width:100%; max-width:400px; background-color: var(--card-color); border-radius:12px; border:1px solid var(--border-color); box-shadow:0 4px 20px rgba(0,0,0,0.4); overflow:hidden; padding:40px; z-index:10;}
  .logo {margin-bottom:20px; display:flex; align-items:center; justify-content:center;}
  .logo img {height:100px; width:200px;}
  h3 {font-size:1.8rem; color:white; margin-bottom:10px; text-align:center;}
  p.form-description {font-size:0.9rem; color:var(--text-color); margin-bottom:20px; text-align:center;}
  .login-form .input-group {margin-bottom:20px; position:relative;}
  .login-form label {display:block; margin-bottom:8px; font-size:0.9rem; color:white; font-weight:500;}
  .login-form input {width:100%; padding:12px; background-color:var(--panel-color); border:1px solid var(--border-color); border-radius:6px; color:white; font-size:1rem; transition:border-color 0.3s ease;}
  .login-form input:focus {outline:none; border-color:var(--highlight-color);}
  .error-message {font-size:0.8rem; color:var(--error-color); margin-top:5px; display:none;}
  .error-message.show {display:block;}

  .password-input-wrapper {position:relative;}
  .password-toggle-icon {position:absolute; right:15px; top:50%; transform:translateY(-50%); color:var(--text-color); cursor:pointer; transition:color 0.2s ease;}

  .login-form button {width:100%; padding:15px; background-color:var(--highlight-color); color:white; border:none; border-radius:6px; font-size:1rem; font-weight:600; cursor:pointer; transition: all 0.2s ease; box-shadow: 0 4px 15px var(--btn-shadow); position: relative; top: 0;}
  .login-form button:hover {background-color: var(--btn-bg-hover); box-shadow: 0 8px 20px var(--btn-shadow); transform: translateY(-2px);}
  .login-form button:active {transform: translateY(1px); box-shadow: 0 2px 10px var(--btn-shadow);}

  .signup-link {text-align:center; margin-top:15px; font-size:0.9rem; color:var(--text-color);}
  .signup-link a {color:var(--highlight-color); text-decoration:none; font-weight:500;}
  .signup-link a:hover {text-decoration:underline;}
</style>
</head>
<body>
  <div class="login-page">
    <div class="logo">
      <img src="https://raw.githubusercontent.com/TM1476/TradeXMatrix/main/logo-pica.png" alt="TXM Logo" />
    </div>
    <h3>Login to Your Account</h3>
    <p class="form-description">Enter your credentials to access your Trade X Matrix account.</p>

    <form class="login-form" onsubmit="event.preventDefault(); loginUser();">
      <div class="input-group">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required>
        <span id="email-error" class="error-message"></span>
      </div>
      <div class="input-group">
        <label for="password">Password</label>
        <div class="password-input-wrapper">
          <input type="password" id="password" name="password" required>
          <i class="fas fa-eye password-toggle-icon" id="toggle-password"></i>
        </div>
        <span id="password-error" class="error-message"></span>
      </div>

      <div class="g-recaptcha" data-sitekey="6Lecd9ArAAAAAG0TRqJrmeFpjT7_og0I1eYZ7fBX"></div>
      <span id="recaptcha-error" class="error-message">Please complete the CAPTCHA.</span>

      <button type="submit">Secure Login</button>
    </form>

    <div class="signup-link">
      Don't have an account? <a href="signup.html">Sign Up</a>
    </div>
  </div>

  <script>
    const passwordInput = document.getElementById('password');
    document.getElementById('toggle-password').addEventListener('click', function() {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye-slash');
    });
  </script>

  <script type="module">
    import { auth } from './src/firebase/firebase.js';
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

    async function loginUser() {
      // Clear previous errors
      document.getElementById('email-error').classList.remove('show');
      document.getElementById('password-error').classList.remove('show');
      document.getElementById('recaptcha-error').classList.remove('show');

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      // Check reCAPTCHA
      if (typeof grecaptcha === 'undefined' || grecaptcha.getResponse().length === 0) {
        document.getElementById('recaptcha-error').classList.add('show');
        return;
      }

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        console.log("Login successful:", userCredential.user.email);
        window.location.href = "home.html";
      } catch (error) {
        if (typeof grecaptcha !== 'undefined') grecaptcha.reset();

        switch(error.code){
          case "auth/user-not-found":
            document.getElementById('email-error').textContent = "No account found with this email.";
            document.getElementById('email-error').classList.add('show');
            break;
          case "auth/wrong-password":
            document.getElementById('password-error').textContent = "Incorrect password.";
            document.getElementById('password-error').classList.add('show');
            break;
          case "auth/invalid-email":
            document.getElementById('email-error').textContent = "Invalid email format.";
            document.getElementById('email-error').classList.add('show');
            break;
          case "auth/too-many-requests":
            alert("Too many attempts. Please try again later.");
            break;
          default:
            alert("Login Failed: " + error.message);
        }
      }
    }

    window.loginUser = loginUser;
  </script>
</body>
</html>
