<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TradeXMatrix - Sign Up</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<style>
:root {
    --bg-color: #121217;
    --card-color: #1b1b24;
    --panel-color: #1a1a21;
    --text-color: #c7c7ce;
    --highlight-color: #00A381;
    --btn-hover: #008d70;
    --border-color: #2b2b36;
    --yellow: #ffcc00;
}

/* Reset */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }

/* Body and Background */
body { background: var(--bg-color); color: var(--text-color); display:flex; justify-content:center; align-items:center; min-height:100vh; overflow-x:hidden; }
body::before { content:""; position:fixed; top:0; left:0; width:100%; height:100%; background: radial-gradient(circle, rgba(18,18,23,0.95), rgba(12,12,17,0.9)); z-index:-1; }

/* Animated Dots */
.animated-dots { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:-2; overflow:hidden; }
.dot { position:absolute; background: rgba(0,163,129,0.2); border-radius:50%; animation: moveDot 20s infinite ease-in-out; }
.dot.large { width:5px; height:5px; opacity:0.2; }
.dot.medium { width:3px; height:3px; opacity:0.3; }
.dot.small { width:2px; height:2px; opacity:0.4; }
@keyframes moveDot {0% {transform: translate(var(--x-start), var(--y-start));}100%{transform: translate(var(--x-end), var(--y-end));}}

/* Signup Page */
.signup-page { display:flex; width:100%; max-width:950px; border-radius:12px; overflow:hidden; box-shadow:0 6px 25px rgba(0,0,0,0.5); }
.signup-details { flex:1; background: var(--panel-color); padding:40px; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
.signup-details .logo img { width:300px; margin-bottom:20px; }
.signup-details h2 { font-size:2.5rem; margin-bottom:10px; color:white; }
.signup-details .subtitle { font-size:1rem; margin-bottom:20px; color:#b0b0b0; }
.signup-details ul { list-style:none; margin-top:20px; padding-left:0; }
.signup-details ul li { margin-bottom:15px; font-size:0.95rem; font-weight:500; color:white; }
.signup-details ul li i { color: var(--highlight-color); margin-right:10px; }

/* Signup Form */
.signup-form-container { flex:1; padding:40px; display:flex; flex-direction:column; justify-content:center; }
.signup-form-container h3 { font-size:2rem; margin-bottom:5px; text-align:center; color:white; }
.signup-form-container .subtitle { font-size:0.95rem; margin-bottom:25px; text-align:center; color:#b0b0b0; }

.signup-form { display:flex; flex-direction:column; gap:15px; }
.input-group { display:flex; flex-direction:column; gap:5px; }
.input-group label { font-size:0.9rem; font-weight:500; }
.input-group input, .input-group select { padding:12px; border-radius:6px; border:1px solid var(--border-color); background:var(--card-color); color:white; font-size:1rem; transition:border 0.3s; }
.input-group input:focus, .input-group select:focus { outline:none; border-color: var(--highlight-color); }

.password-input-wrapper { position:relative; }
.password-toggle-icon { position:absolute; right:15px; top:50%; transform:translateY(-50%); cursor:pointer; color:#c7c7ce; }
.password-toggle-icon:hover { color:white; }

button { padding:14px; background: var(--highlight-color); color:white; border:none; border-radius:6px; font-weight:600; cursor:pointer; transition: background 0.3s; }
button:hover { background: var(--btn-hover); }

.terms-policy-group { display:flex; align-items:flex-start; gap:10px; font-size:0.9rem; }
.terms-policy-group input { width:16px; height:16px; accent-color:var(--highlight-color); }
.terms-policy-group a { color: var(--highlight-color); text-decoration:none; }
.terms-policy-group a:hover { text-decoration:underline; }

.validation-message { font-size:0.8rem; color:#ff6347; display:none; }
.validation-message.show { display:block; }

.social-login { text-align:center; margin-bottom:20px; }
.or-separator { display:flex; align-items:center; text-align:center; color:#b0b0b0; font-size:0.9rem; margin:10px 0; }
.or-separator::before, .or-separator::after { content:''; flex:1; border-bottom:1px solid var(--border-color); margin:0 10px; }
.social-button { display:flex; align-items:center; justify-content:center; gap:10px; padding:12px; border-radius:6px; border:1px solid var(--border-color); font-weight:500; cursor:pointer; text-decoration:none; transition:all 0.3s; }
.social-button.google-btn { background:#4285F4; color:white; border-color:#4285F4; }
.social-button.google-btn:hover { background:#357ae8; border-color:#357ae8; }

/* Responsive */
@media(max-width:768px) {
    .signup-page { flex-direction:column; max-width:450px; }
    .signup-details { display:none; }
    .signup-form-container { padding:30px; }
}

/* Modal */
.modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; justify-content:center; align-items:center; z-index:1000; opacity:0; visibility:hidden; transition:all 0.3s; }
.modal-overlay.active { opacity:1; visibility:visible; }
.modal-content { background: var(--card-color); padding:30px; border-radius:10px; width:90%; max-width:700px; max-height:80vh; overflow-y:auto; border:1px solid var(--border-color); }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
.modal-header h4 { color:white; }
.modal-close { background:none; border:none; font-size:1.5rem; color:var(--text-color); cursor:pointer; }
.modal-close:hover { color: var(--highlight-color); }
</style>
</head>
<body>
<div class="animated-dots"></div>

<div class="signup-page">
    <!-- Left Panel -->
    <div class="signup-details">
        <div class="logo"><img src="https://raw.githubusercontent.com/TM1476/TradeXMatrix/main/logo-pica.png" alt="TXM Logo"></div>
        <h2>Join TradeXMatrix</h2>
        <p class="subtitle">Empowering traders with advanced tools, insights, and real-time market data.</p>
        <ul>
            <li><i class="fa-solid fa-chart-line"></i> Advanced Live Charting</li>
            <li><i class="fa-solid fa-bell"></i> Personalized Trading Alerts</li>
            <li><i class="fa-solid fa-headset"></i> Dedicated Customer Support</li>
            <li><i class="fa-solid fa-users"></i> Exclusive Community Access</li>
        </ul>
    </div>

    <!-- Right Panel -->
    <div class="signup-form-container">
        <h3>Create Your Free Account</h3>
        <p class="subtitle">Start your trading journey with professional-grade tools and insights.</p>

        <div class="social-login">
            <a href="#" class="social-button google-btn" id="google-signup"><i class="fab fa-google"></i> Sign up with Google</a>
            <div class="or-separator">or</div>
        </div>

        <form class="signup-form" onsubmit="event.preventDefault(); validateForm();">
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter your username" required>
                <span class="validation-message" id="username-validation"></span>
            </div>

            <div class="input-group">
                <label for="email">Email</label>
                <input type="email" id="email" placeholder="Enter your email" required>
                <span class="validation-message" id="email-validation"></span>
            </div>

            <div class="input-group password-input-wrapper">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
                <i class="fas fa-eye password-toggle-icon" id="toggle-password"></i>
                <span class="validation-message" id="password-validation"></span>
            </div>

            <div class="input-group password-input-wrapper">
                <label for="confirm-password">Confirm Password</label>
                <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                <i class="fas fa-eye password-toggle-icon" id="toggle-confirm-password"></i>
                <span class="validation-message" id="confirm-password-validation"></span>
            </div>

            <div class="input-group">
                <label for="timezone">Timezone</label>
                <select id="timezone">
                    <option value="Asia/Kolkata" selected>Asia/Kolkata</option>
                    <option value="UTC">UTC</option>
                    <option value="America/New_York">America/New_York</option>
                    <option value="Europe/London">Europe/London</option>
                </select>
            </div>

            <div class="g-recaptcha" data-sitekey="6Lecd9ArAAAAAG0TRqJrmeFpjT7_og0I1eYZ7fBX"></div>

            <div class="terms-policy-group">
                <input type="checkbox" id="agree-terms">
                <label for="agree-terms">I agree to the <a href="#" onclick="showModal('tos-modal'); return false;">Terms</a> & <a href="#" onclick="showModal('pp-modal'); return false;">Privacy Policy</a></label>
            </div>
            <span class="validation-message" id="terms-policy-validation">You must agree to the Terms & Privacy.</span>
            <span class="validation-message" id="recaptcha-validation">Please complete the CAPTCHA.</span>

            <button type="submit">Create Account</button>
        </form>
    </div>
</div>

<!-- Modals -->
<div id="tos-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h4>Terms of Service</h4><button class="modal-close" onclick="closeModal('tos-modal')">&times;</button></div>
        <div class="modal-body">
            <p>Terms content here...</p>
        </div>
    </div>
</div>
<div id="pp-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h4>Privacy Policy</h4><button class="modal-close" onclick="closeModal('pp-modal')">&times;</button></div>
        <div class="modal-body">
            <p>Privacy content here...</p>
        </div>
    </div>
</div>

<script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyC7OlOJlG6HGombrxytI4mvldAm39YZD-s",
    authDomain: "tradexmatrix-txm.firebaseapp.com",
    projectId: "tradexmatrix-txm",
    storageBucket: "tradexmatrix-txm.firebasestorage.app",
    messagingSenderId: "683396221594",
    appId: "1:683396221594:web:db1669b666607b948d2d23",
    measurementId: "G-RMP0BPSG2X"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const googleProvider = new GoogleAuthProvider();

// Firestore function
async function upsertUserProfile(user) {
    const userRef = doc(db, "users", user.uid);
    const timezone = document.getElementById('timezone').value || 'Asia/Kolkata';
    const userData = {
        uid: user.uid,
        email: user.email || "",
        username: user.displayName || document.getElementById('username').value || "",
        accountTier: 'Free',
        emailVerified: user.emailVerified || false,
        onboardingStep: 0,
        preferredTimezone: timezone,
        defaultMarket: 'NSE',
        demoBalance: 100000,
        performance: 100,
        Theme: "dark",
        Onboarding: "",
        photoURL: user.photoURL || "",
        createdAt: serverTimestamp(),
        lastSignIn: serverTimestamp(),
    };
    await setDoc(userRef, userData, { merge:true });
}

// Google Signup
document.getElementById('google-signup').addEventListener('click', async (e)=>{
    e.preventDefault();
    if(!document.getElementById('agree-terms').checked){ alert("Agree Terms first."); return; }
    try{
        const result = await signInWithPopup(auth, googleProvider);
        await upsertUserProfile(result.user);
        alert("Signed in with Google!");
        window.location.href="login.html";
    } catch(e){ console.error(e); alert("Google sign-in failed."); }
});

// Password toggle
document.getElementById('toggle-password').addEventListener('click',()=>{
    const pwd=document.getElementById('password'); pwd.type=pwd.type==='password'?'text':'password';
    document.getElementById('toggle-password').classList.toggle('fa-eye-slash');
});
document.getElementById('toggle-confirm-password').addEventListener('click',()=>{
    const pwd=document.getElementById('confirm-password'); pwd.type=pwd.type==='password'?'text':'password';
    document.getElementById('toggle-confirm-password').classList.toggle('fa-eye-slash');
});

// Modal functions
function showModal(id){ document.getElementById(id).classList.add('active'); document.body.style.overflow='hidden'; }
function closeModal(id){ document.getElementById(id).classList.remove('active'); document.body.style.overflow='auto'; }
document.querySelectorAll('.modal-overlay').forEach(overlay=>overlay.addEventListener('click', e=>{ if(e.target===overlay) closeModal(overlay.id); }));

// Animated dots
const animatedDots=document.querySelector('.animated-dots');
for(let i=0;i<50;i++){ 
    const dot=document.createElement('div'); 
    dot.classList.add(['dot','small'][Math.floor(Math.random()*3)]); 
    dot.style.setProperty('--x-start',Math.random()*100+'vw'); 
    dot.style.setProperty('--y-start',Math.random()*100+'vh'); 
    dot.style.setProperty('--x-end',Math.random()*100+'vw'); 
    dot.style.setProperty('--y-end',Math.random()*100+'vh'); 
    dot.style.animationDuration=(Math.random()*15+10)+'s'; 
    dot.style.animationDelay=(Math.random()*5)+'s'; 
    animatedDots.appendChild(dot);}
</script>
</body>
</html>
